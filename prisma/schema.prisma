generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ingredients {
  id                 String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name               String               @unique @db.VarChar(100)
  recipe_ingredients recipe_ingredients[]
}

model recipe_ingredients {
  recipe_id     String      @db.Uuid
  ingredient_id String      @db.Uuid
  quantity      String?     @db.VarChar(50)
  ingredients   ingredients @relation(fields: [ingredient_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  recipes       recipes     @relation(fields: [recipe_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([recipe_id, ingredient_id])
}

model recipes {
  id                 String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id            String               @db.Uuid
  title              String               @db.VarChar(255)
  description        String?
  instructions       String?
  created_at         DateTime?            @default(now()) @db.Timestamptz(6)
  recipe_ingredients recipe_ingredients[]
  users              users                @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user_favorites     user_favorites[]
  user_notes         user_notes[]
}

model user_favorites {
  user_id   String  @db.Uuid
  recipe_id String  @db.Uuid
  recipes   recipes @relation(fields: [recipe_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users     users   @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([user_id, recipe_id])
}

model user_notes {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String    @db.Uuid
  recipe_id  String    @db.Uuid
  note       String
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
  recipes    recipes   @relation(fields: [recipe_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model users {
  id              String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  username        String           @unique @db.VarChar(50)
  email           String           @unique @db.VarChar(255)
  password_hash   String
  profile_picture String?
  joined_date     DateTime?        @default(now()) @db.Timestamptz(6)
  recipes         recipes[]
  user_favorites  user_favorites[]
  user_notes      user_notes[]
}
